name: schedule test
on: 
  push: 
    branches:
      - master

jobs:
  douyu:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        roomid:
          - 88080
          - 5720533
    steps:
      - uses: actions/checkout@v4

      - name: download evina
        run: |
          wget $(curl https://api.github.com/repos/soft-cute/evina/releases/125357820/assets | jq -r .[3].browser_download_url)
          tar -xvf evina*.tar.xz
          sudo chmod +x ./evina    

      - name: check ${{ matrix.roomid }}
        id: check_workflow
        uses: ./.github/check
        with: 
          token: ${{ secrets.GITHUB_TOKEN }}
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          name: "schedule test"
          name_step: "evina ${{ matrix.roomid }}"
          num_step: 5

      - name: evina ${{ matrix.roomid }}
        if: steps.check_workflow.outputs.in_progress == false
        run: |
          sudo ./evina -l douyu -i ${{ matrix.roomid }} -m -d douyu-${{ matrix.roomid }}

